
<div class="banner" style="background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url(https://res.cloudinary.com/teayudo2049/image/upload/v1631127364/index_-logo_cwwpjh.jpg);">
  <div class="container">
    <h1> <strong>Mi Perfil</strong> </h1>
  </div>
</div>
<div class="container">
  <!--  profile usuario   -->

    <div class="card-product-misdatos mt-4 col-sm-12">
      <div class="col-sm-4 card-product-fotomisdatos"> 
        <% if current_user.photo.attached? %>
          <%= cl_image_tag current_user.photo.key %>
        <% else %>
        <% end %> 
      </div>
      <div class="card-product-infos col-sm-5">
        <h3><strong>Mis Datos</strong></h3> 
        <p class="mt-3"><%= current_user.first_name %> <%= current_user.last_name%></p>
        <p><%= current_user.email %></p>
      </div>
      <div class="col-sm-3">
        <%= link_to 'Editar mi perfil', edit_user_registration_path, class:"btn btn-primary edit-btn mb-2"%>
      </div>
    </div>

  <!--  servicios ofrecidos por el usuario   -->

    <h4 class= "mt-4">Mis servicios:</h4>
    <div class="row">
      <% @my_services.each do |service| %>
        <div class="col-md-6">
          <div class="card-product mt-3 col-sm-12">
            <div class="col-sm-4"> 
              <% if service.photo.attached? %>
                <%= cl_image_tag service.photo.key %>
              <% else %>
                <%= cl_image_tag("Marketing-de-Servicios-1_xgaiwu") %>
              <% end %> 
            </div>
            <div class="card-product-infos col-sm-4">
              <h2><strong><%= service.name %></strong></h2>
              <p>$<strong> <%= service.price %></strong></p> 
              <p><strong>Rese√±as: <%= service.reviews.count %></strong></p>
              <p><strong>Contrataciones: <%= service.reviews.count %></strong></p>
              <% ratings = [] %>
              <% average = 0 %>
              <% service.reviews.each do | review |  %>
                <% ratings << review.rating %>
                <% average = ratings.sum/ratings.count %>
              <% end %>
              <div> 
                <% average.times do %>
                  <i class="fas fa-star"></i>
                <% end %>
                <% (5 - average).times do %>
                  <i class="far fa-star"></i>
                <% end %>
              </div> 
            </div>



            <div class="col-sm-4">
              <%= link_to 'Detalle', service_path(service), class:"btn btn-primary edit-btn mb-2"%>
              <%= link_to 'Editar', edit_service_path(service), class:"btn btn-primary edit-btn mb-2"%>
              <%= link_to 'Dar de baja', service_path(service), method: :delete, data: { confirm: "Estas seguro de querer borrar este servicio?"}, class:"btn btn-primary delete-btn"%>
            </div>
          </div>
        </div>
      <% end %>
    </div>




    
      
    

    <% if @my_bookings.count == 0 %>
      <h4 class="mt-3">Que esperas para contratar un servicio!</h4>
    <% else %>
      <h4 class= "mt-4">Mis reservas:</h4>
      <% @my_bookings.each do |booking| %>
        <div class="card-product mt-3 col-sm-12">
          <div class="col-sm-3"> 
            <% if booking.service.photo.attached? %>
              <%= cl_image_tag booking.service.photo.key %>
            <% else %>
              <%= cl_image_tag("Marketing-de-Servicios-1_xgaiwu") %>
            <% end %> 
          </div>
          <div class="card-product-infos col-sm-6">
            <h2>Nombre: <%= booking.service.name %></h2>
            <p>Precio: $ <strong><%= booking.service.price %></strong></p> 
            <p>Contacto: <%= booking.service.user.email%></p>
          </div>

          <div class="col-sm-3">
            <%= link_to 'Detalle', service_path(booking.service), class:"btn btn-primary edit-btn mb-2"%>
            <%= link_to 'Dar de baja', booking_path(booking), method: :delete, data: { confirm: "Estas seguro de querer dar de baja esta reserva?"}, class:"btn btn-primary delete-btn"%>
          </div>
        </div>
      <% end %>        
    <% end %>
  </div>

</div>


<hr class="mb-4">

<%= render 'shared/mini-footer' %>
